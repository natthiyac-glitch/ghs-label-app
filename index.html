<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GHS Label Generator - Professional (Backup Edition)</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap');
        
        body { 
            font-family: 'Sarabun', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            margin: 0;
            padding: 0;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #667eea; border-radius: 10px; }

        input, select, textarea {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
        }
        input:focus, select:focus, textarea:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
            outline: none;
        }
        
        input[type=range] {
            height: 25px;
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 10px;
        }
        input[type=range]::-webkit-slider-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #667eea;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            -webkit-appearance: none;
            margin-top: -6px;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 12px;
        }
        .gallery-item {
            cursor: pointer;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 8px;
            transition: all 0.2s;
            position: relative;
            background: white;
            aspect-ratio: 1/1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .gallery-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .gallery-delete {
            position: absolute;
            top: -6px;
            right: -6px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s;
            cursor: pointer;
        }
        .gallery-item:hover .gallery-delete {
            opacity: 1;
        }

        @media print {
            .no-print { display: none !important; }
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { jsPDF } = window.jspdf;

        // --- Helper: Image Compressor ---
        const compressImage = (base64Str, maxWidth = 300, quality = 0.7) => {
            return new Promise((resolve) => {
                const img = new Image();
                img.src = base64Str;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;

                    if (width > maxWidth) {
                        height *= maxWidth / width;
                        width = maxWidth;
                    }

                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    resolve(canvas.toDataURL('image/jpeg', quality));
                };
                img.onerror = () => resolve(base64Str); // Fallback
            });
        };

        // NFPA Diamond Component
        const NFPADiamond = ({ health, flammability, instability, special }) => (
            <div className="relative w-full h-full">
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-md">
                    <polygon points="50,50 25,75 0,50 25,25" fill="#60A5FA" stroke="black" strokeWidth="1" />
                    <polygon points="50,50 25,25 50,0 75,25" fill="#F87171" stroke="black" strokeWidth="1" />
                    <polygon points="50,50 75,25 100,50 75,75" fill="#FBBF24" stroke="black" strokeWidth="1" />
                    <polygon points="50,50 75,75 50,100 25,75" fill="white" stroke="black" strokeWidth="1" />
                    <text x="25" y="55" textAnchor="middle" fontSize="22" fontWeight="bold" fill="black">{health}</text>
                    <text x="50" y="30" textAnchor="middle" fontSize="22" fontWeight="bold" fill="black">{flammability}</text>
                    <text x="75" y="55" textAnchor="middle" fontSize="22" fontWeight="bold" fill="black">{instability}</text>
                    <text x="50" y="80" textAnchor="middle" fontSize="16" fontWeight="bold" fill="black">{special}</text>
                </svg>
            </div>
        );

        // Font Slider Component
        const FontSlider = ({ label, value, onChange, min = 0.5, max = 2.0, step = 0.05 }) => (
            <div className="flex flex-col mb-2 p-2 bg-white rounded-lg border shadow-sm">
                <div className="flex justify-between items-center mb-1">
                    <label className="text-xs font-bold text-gray-600">{label}</label>
                    <span className="text-xs text-indigo-600 font-bold bg-indigo-50 px-2 py-0.5 rounded-full">{Math.round(value * 100)}%</span>
                </div>
                <input 
                    type="range" 
                    min={min} 
                    max={max} 
                    step={step} 
                    value={value} 
                    onChange={(e) => onChange(parseFloat(e.target.value))} 
                />
            </div>
        );

        // GHS Label Component
        const GHSLabel = ({ formData, scales, id, onClick }) => (
            <div 
                id={id} 
                onClick={onClick} 
                className={`bg-white border-4 border-black w-full aspect-[1.5/1] flex flex-col shadow-2xl relative overflow-hidden ${onClick ? 'cursor-pointer hover:scale-[1.01]' : ''} transition-all duration-300`}
            >
                {/* Header */}
                <div className="flex border-b-4 border-black h-[18%]">
                    <div className="w-[25%] bg-yellow-300 flex items-center justify-center text-center border-r-4 border-black p-1 overflow-hidden">
                        <span className="font-black font-mono w-full leading-none break-words" style={{ fontSize: `${2.5 * scales.tankId}rem` }}>{formData.tankId}</span>
                    </div>
                    <div className="w-[55%] flex items-center justify-center text-center border-r-4 border-black p-2 overflow-hidden">
                        <span className="font-black uppercase w-full leading-none break-words" style={{ fontSize: `${2.2 * scales.productName}rem` }}>{formData.productName || "CHEMICAL NAME"}</span>
                    </div>
                    <div className="w-[20%] flex flex-col items-center justify-center text-center p-1 bg-gray-100">
                        <span className="font-bold text-gray-500 text-xs uppercase mb-1 w-full">UN Number</span>
                        <span className="font-black font-mono leading-none w-full" style={{ fontSize: `${2 * scales.unNumber}rem` }}>{formData.unNumber || "----"}</span>
                    </div>
                </div>

                {/* Body */}
                <div className="flex flex-grow border-b-4 border-black h-[62%]">
                    {/* Left: Pictogram + Signal */}
                    <div className="w-[30%] border-r-4 border-black flex flex-col">
                        <div className="h-[75%] flex flex-wrap items-center justify-center gap-1 p-1 content-center overflow-hidden" style={{ transform: `translate(${scales.picX || 0}px, ${scales.picY || 0}px) scale(${scales.picScale || 1})` }}>
                            {formData.pictograms.length > 0 ? (
                                formData.pictograms.map((img, i) => {
                                    const count = formData.pictograms.length;
                                    let sizeClass = count === 1 ? "w-[85%] h-[85%]" : count > 4 ? "w-[30%] h-[30%]" : "w-[45%] h-[45%]";
                                    return <img key={i} src={img} className={`object-contain ${sizeClass}`} alt="Pictogram" />;
                                })
                            ) : (
                                <div className="text-gray-300 text-xs text-center">‡∏£‡∏π‡∏õ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå</div>
                            )}
                        </div>

                        <div className="h-[25%] flex items-center justify-center p-1 bg-white">
                            {formData.signalWord && (
                                <div className="font-black uppercase px-2 py-0.5 rounded text-center text-black" style={{ fontSize: `${1.5 * scales.signal}rem` }}>
                                    {formData.signalWord}
                                </div>
                            )}
                        </div>
                    </div>
                    
                    {/* Right: Text */}
                    <div className="w-[70%] p-4 flex flex-col justify-start overflow-hidden">
                        <div className="mb-4">
                            <h3 className="font-bold underline mb-1" style={{ fontSize: `${1.2 * scales.hazard}rem` }}>HAZARD STATEMENTS:</h3>
                            <p className="whitespace-pre-line font-semibold" style={{ fontSize: `${1 * scales.hazard}rem` }}>{formData.hazardStatements || "..."}</p>
                        </div>

                        <div>
                            <h3 className="font-bold underline mb-1" style={{ fontSize: `${1.2 * scales.precaution}rem` }}>PRECAUTIONARY STATEMENTS:</h3>
                            <p className="whitespace-pre-line font-semibold" style={{ fontSize: `${1 * scales.precaution}rem` }}>{formData.precautionaryStatements || "..."}</p>
                        </div>
                    </div>
                </div>

                {/* Footer */}
                <div className="h-[20%] flex">
                    <div className="w-[30%] border-r-4 border-black p-2 flex items-center justify-center bg-white">
                        <div className="aspect-square h-full max-h-[100px]" style={{ transform: `scale(${scales.nfpa})` }}>
                            <NFPADiamond 
                                health={formData.nfpaHealth} 
                                flammability={formData.nfpaFlammability} 
                                instability={formData.nfpaInstability} 
                                special={formData.nfpaSpecial} 
                            />
                        </div>
                    </div>

                    <div className="w-[70%] p-3 pb-4 flex flex-col bg-blue-50">
                        <h3 className="font-bold uppercase text-blue-900 text-xs mb-1 underline" style={{ fontSize: `${0.8 * scales.ppeHeader}rem` }}>
                            PPE SPECIFIC
                        </h3>
                        
                        <div className="flex flex-row h-full gap-2">
                            <div className="flex-grow w-[45%] overflow-hidden">
                                <p className="whitespace-pre-line font-semibold text-blue-900" style={{ fontSize: `${0.9 * scales.ppeText}rem` }}>
                                    {formData.ppeText || "‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô..."}
                                </p>
                            </div>
                            
                            <div className="w-[55%] flex items-center justify-end gap-1 pb-1">
                                {formData.ppeImages.map((img, i) => (
                                    <div key={i} className={`h-full w-1/5 flex items-center justify-center ${img ? 'border border-blue-200 bg-white' : ''}`}>
                                        {img && <img src={img} className="max-h-full max-w-full object-contain" alt={`PPE ${i+1}`} />}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );

        // Main App
        function App() {
            const [formData, setFormData] = useState({
                tankId: 'T-0101',
                productName: '',
                unNumber: '',
                signalWord: 'DANGER',
                hazardStatements: '',
                precautionaryStatements: '', 
                ppeText: '', 
                pictograms: [], 
                ppeImages: [null, null, null, null, null],
                nfpaHealth: 0, 
                nfpaFlammability: 0, 
                nfpaInstability: 0, 
                nfpaSpecial: '',
            });

            const [scales, setScales] = useState({
                tankId: 1, productName: 1, unNumber: 1, hazard: 1, precaution: 1, 
                ppeText: 1, ppeHeader: 1, signal: 1, nfpa: 1,
                picX: 0, picY: 0, picScale: 1
            });
            
            const [libraryImages, setLibraryImages] = useState([]);
            const [ppeLibraryImages, setPpeLibraryImages] = useState([]);
            const [activePPESlot, setActivePPESlot] = useState(null);
            const [savedLabels, setSavedLabels] = useState([]);
            
            const [showFontPanel, setShowFontPanel] = useState(false);
            const [showLibrary, setShowLibrary] = useState(false);
            const [showGallery, setShowGallery] = useState(false);
            const [showPPEGallery, setShowPPEGallery] = useState(false);
            
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [isGenerating, setIsGenerating] = useState(false);

            // Load from localStorage
            useEffect(() => {
                const saved = localStorage.getItem('ghs_templates');
                if (saved) try { setSavedLabels(JSON.parse(saved)); } catch (e) {}
                
                const lib = localStorage.getItem('ghs_my_pictograms');
                if (lib) try { setLibraryImages(JSON.parse(lib)); } catch (e) {}
                
                const ppeLib = localStorage.getItem('ghs_my_ppe_library');
                if (ppeLib) try { setPpeLibraryImages(JSON.parse(ppeLib)); } catch (e) {}
            }, []);

            // Data Export/Import Functions
            const handleExportData = () => {
                const data = {
                    savedLabels,
                    libraryImages,
                    ppeLibraryImages
                };
                const jsonStr = JSON.stringify(data);
                const blob = new Blob([jsonStr], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = `GHS_Backup_${new Date().toISOString().slice(0,10)}.json`;
                a.click();
            };

            const handleImportData = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if(confirm("‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ó‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ï‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
                            if (data.savedLabels) {
                                setSavedLabels(data.savedLabels);
                                localStorage.setItem('ghs_templates', JSON.stringify(data.savedLabels));
                            }
                            if (data.libraryImages) {
                                setLibraryImages(data.libraryImages);
                                localStorage.setItem('ghs_my_pictograms', JSON.stringify(data.libraryImages));
                            }
                            if (data.ppeLibraryImages) {
                                setPpeLibraryImages(data.ppeLibraryImages);
                                localStorage.setItem('ghs_my_ppe_library', JSON.stringify(data.ppeLibraryImages));
                            }
                            alert("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                            setShowLibrary(false);
                        }
                    } catch (err) {
                        alert("‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
                    }
                };
                reader.readAsText(file);
            };

            // Library Functions with Compression
            const addToLibrary = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = async () => {
                        const compressed = await compressImage(reader.result); // Compress!
                        try {
                            const newLib = [...libraryImages, compressed];
                            setLibraryImages(newLib);
                            localStorage.setItem('ghs_my_pictograms', JSON.stringify(newLib));
                        } catch (err) {
                            alert("‡πÄ‡∏°‡∏°‡πÇ‡∏°‡∏£‡∏µ‡πà‡πÄ‡∏ï‡πá‡∏°! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏≠‡∏≠‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå Backup");
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };
            
            const deleteFromLibrary = (index, e) => {
                e.stopPropagation(); 
                const newLib = libraryImages.filter((_, i) => i !== index);
                setLibraryImages(newLib);
                localStorage.setItem('ghs_my_pictograms', JSON.stringify(newLib));
            };
            
            const selectFromLibrary = (imgSrc) => {
                setFormData(prev => ({ 
                    ...prev, 
                    pictograms: [...prev.pictograms, imgSrc].slice(0, 9) 
                }));
            };

            // PPE Library Functions with Compression
            const addToPPELibrary = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = async () => {
                        const compressed = await compressImage(reader.result); // Compress!
                        try {
                            const newLib = [...ppeLibraryImages, compressed];
                            setPpeLibraryImages(newLib);
                            localStorage.setItem('ghs_my_ppe_library', JSON.stringify(newLib));
                        } catch (err) {
                            alert("‡πÄ‡∏°‡∏°‡πÇ‡∏°‡∏£‡∏µ‡πà‡πÄ‡∏ï‡πá‡∏°! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏≠‡∏≠‡∏Å");
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };

            const deleteFromPPELibrary = (index, e) => {
                e.stopPropagation();
                const newLib = ppeLibraryImages.filter((_, i) => i !== index);
                setPpeLibraryImages(newLib);
                localStorage.setItem('ghs_my_ppe_library', JSON.stringify(newLib));
            };
            
            const openPPEGalleryForSlot = (index) => {
                setActivePPESlot(index);
                setShowPPEGallery(true);
            };

            const selectFromPPELibrary = (imgSrc) => {
                if (activePPESlot !== null) {
                    const newImages = [...formData.ppeImages];
                    newImages[activePPESlot] = imgSrc;
                    setFormData(prev => ({ ...prev, ppeImages: newImages }));
                    setShowPPEGallery(false);
                    setActivePPESlot(null);
                } else {
                    const emptyIndex = formData.ppeImages.findIndex(img => img === null);
                    if (emptyIndex !== -1) {
                        const newImages = [...formData.ppeImages];
                        newImages[emptyIndex] = imgSrc;
                        setFormData(prev => ({ ...prev, ppeImages: newImages }));
                        setShowPPEGallery(false);
                    } else {
                        alert("‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏£‡∏π‡∏õ‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏ö‡∏£‡∏π‡∏õ‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô");
                    }
                }
            };

            // Template Functions with Try-Catch
            const handleSaveTemplate = () => {
                if (!formData.productName) {
                    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å");
                    return;
                }
                const name = prompt("‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö:", formData.productName);
                if (name) {
                    try {
                        const newTemplate = { id: Date.now(), name, data: { ...formData }, scales: { ...scales } };
                        const updated = [newTemplate, ...savedLabels];
                        localStorage.setItem('ghs_templates', JSON.stringify(updated));
                        setSavedLabels(updated);
                        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
                    } catch (e) {
                        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ï‡πá‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏ö‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö‡πÄ‡∏Å‡πà‡∏≤‡πÜ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤");
                    }
                }
            };
            
            const handleLoadTemplate = (template) => {
                if(confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î "${template.name}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                    setFormData(template.data);
                    if(template.scales) setScales(template.scales);
                    setShowLibrary(false);
                }
            };
            
            const handleDeleteTemplate = (id, e) => {
                e.stopPropagation();
                if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
                    const updated = savedLabels.filter(l => l.id !== id);
                    setSavedLabels(updated);
                    localStorage.setItem('ghs_templates', JSON.stringify(updated));
                }
            };

            // Pictogram Upload with Compression
            const handlePictogramUpload = (e) => {
                const files = Array.from(e.target.files);
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onloadend = async () => {
                        const compressed = await compressImage(reader.result); // Compress!
                        setFormData(prev => ({ 
                            ...prev, 
                            pictograms: [...prev.pictograms, compressed].slice(0, 9)
                        }));
                    };
                    reader.readAsDataURL(file);
                });
            };

            const removePictogram = (index) => {
                setFormData(prev => ({
                    ...prev,
                    pictograms: prev.pictograms.filter((_, i) => i !== index)
                }));
            };

            const clearPPEImage = (index) => {
                const newImages = [...formData.ppeImages];
                newImages[index] = null;
                setFormData(prev => ({ ...prev, ppeImages: newImages }));
            };

            const updateScale = (key, value) => {
                setScales(prev => ({ ...prev, [key]: value }));
            };

            // PDF Download
            const handleDownloadPDF = async () => {
                setIsGenerating(true);
                const currentScrollY = window.scrollY;
                const wasModalOpen = isModalOpen;
                if (!isModalOpen) setIsModalOpen(true);
                
                await new Promise(resolve => setTimeout(resolve, 500)); 
                
                try {
                    const elementToCapture = document.getElementById('tank-label-modal-content');
                    if (!elementToCapture) throw new Error("Element not found");

                    const canvas = await html2canvas(elementToCapture, { 
                        scale: 2,
                        useCORS: true, 
                        logging: false, 
                        backgroundColor: '#ffffff',
                        windowWidth: elementToCapture.scrollWidth,
                        windowHeight: elementToCapture.scrollHeight
                    });

                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jsPDF({ orientation: 'landscape', unit: 'mm', format: 'a4' });
                    const imgProps = pdf.getImageProperties(imgData);
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    const ratio = imgProps.width / imgProps.height;
                    const width = pdfWidth - 20;
                    const height = width / ratio;
                    const x = 10;
                    const y = (pdfHeight - height) / 2;

                    pdf.addImage(imgData, 'PNG', x, y, width, height);
                    pdf.save(`GHS-Label-${formData.tankId || 'Export'}.pdf`);

                    if (!wasModalOpen) setIsModalOpen(false);
                    setTimeout(() => window.scrollTo(0, currentScrollY), 100);
                } catch (error) {
                    console.error("PDF Error:", error);
                    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á PDF");
                } finally {
                    setIsGenerating(false);
                }
            };

            return (
                <div className="min-h-screen pb-10">
                    
                    {/* Header */}
                    <div className="no-print bg-white/95 backdrop-blur-lg shadow-sm border-b sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto px-4 py-3 flex flex-wrap justify-between items-center gap-3">
                            <h1 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                                <span className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-2 rounded-lg">‚öóÔ∏è</span>
                                ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡πâ‡∏≤‡∏¢ GHS
                            </h1>
                            
                            <div className="flex flex-wrap gap-2">
                                <button onClick={() => setShowLibrary(true)} className="px-4 py-2 rounded-lg bg-yellow-100 border border-yellow-300 text-yellow-700 hover:bg-yellow-200 font-semibold transition">
                                    üìÅ ‡∏Ñ‡∏•‡∏±‡∏á‡∏õ‡πâ‡∏≤‡∏¢
                                </button>
                                <button onClick={handleSaveTemplate} className="px-4 py-2 rounded-lg bg-green-100 border border-green-300 text-green-700 hover:bg-green-200 font-semibold transition">
                                    üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                                </button>
                                <button onClick={() => setShowFontPanel(!showFontPanel)} className={`px-4 py-2 rounded-lg font-semibold transition ${showFontPanel ? 'bg-indigo-100 border-indigo-300 text-indigo-700' : 'bg-gray-100 border-gray-300 text-gray-600 hover:bg-gray-200'}`}>
                                    üî§ ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Font Panel */}
                    {showFontPanel && (
                        <div className="fixed top-20 right-4 bg-white p-5 shadow-2xl border rounded-2xl z-50 w-80 max-h-[70vh] overflow-y-auto">
                            <div className="flex justify-between items-center border-b pb-3 mb-3">
                                <h3 className="font-bold text-gray-700">‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h3>
                                <button onClick={() => setShowFontPanel(false)} className="text-gray-400 hover:text-red-500">‚úï</button>
                            </div>
                            <div className="space-y-2">
                                <FontSlider label="‡∏£‡∏´‡∏±‡∏™‡∏ñ‡∏±‡∏á" value={scales.tankId} onChange={v => updateScale('tankId', v)} />
                                <FontSlider label="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ" value={scales.productName} onChange={v => updateScale('productName', v)} />
                                <FontSlider label="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç UN" value={scales.unNumber} onChange={v => updateScale('unNumber', v)} />
                                <FontSlider label="‡∏Ñ‡∏≥‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì" value={scales.signal} onChange={v => updateScale('signal', v)} />
                                <FontSlider label="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢" value={scales.hazard} onChange={v => updateScale('hazard', v)} />
                                <FontSlider label="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á" value={scales.precaution} onChange={v => updateScale('precaution', v)} />
                                <FontSlider label="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ PPE" value={scales.ppeHeader} onChange={v => updateScale('ppeHeader', v)} />
                                <FontSlider label="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ PPE" value={scales.ppeText} onChange={v => updateScale('ppeText', v)} />
                                <FontSlider label="‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏π‡∏õ" value={scales.picScale} onChange={v => updateScale('picScale', v)} />
                                <FontSlider label="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á X" value={scales.picX} min={-100} max={100} step={5} onChange={v => updateScale('picX', v)} />
                                <FontSlider label="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á Y" value={scales.picY} min={-100} max={100} step={5} onChange={v => updateScale('picY', v)} />
                                <FontSlider label="‡∏Ç‡∏ô‡∏≤‡∏î NFPA" value={scales.nfpa} onChange={v => updateScale('nfpa', v)} />
                            </div>
                        </div>
                    )}

                    <div className="max-w-7xl mx-auto p-4 md:p-8 flex flex-col lg:flex-row gap-8">
                        {/* Input Form */}
                        <div className="no-print w-full lg:w-1/3 bg-white p-6 rounded-2xl shadow-lg space-y-6 h-fit max-h-[85vh] overflow-y-auto">
                            <div className="space-y-4">
                                <h3 className="font-bold text-indigo-600 text-lg border-b-2 pb-2">üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h3>
                                <div className="grid grid-cols-2 gap-3">
                                    <div>
                                        <label className="text-xs font-bold text-gray-500 ml-1">‡∏£‡∏´‡∏±‡∏™‡∏ñ‡∏±‡∏á</label>
                                        <input type="text" className="w-full p-2.5 rounded-lg bg-gray-50" value={formData.tankId} onChange={e => setFormData({...formData, tankId: e.target.value})} />
                                    </div>
                                    <div>
                                        <label className="text-xs font-bold text-gray-500 ml-1">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç UN</label>
                                        <input type="text" className="w-full p-2.5 rounded-lg bg-gray-50" value={formData.unNumber} onChange={e => setFormData({...formData, unNumber: e.target.value})} />
                                    </div>
                                    <div className="col-span-2">
                                        <label className="text-xs font-bold text-gray-500 ml-1">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ</label>
                                        <input type="text" className="w-full p-2.5 rounded-lg bg-gray-50 font-bold" value={formData.productName} onChange={e => setFormData({...formData, productName: e.target.value})} placeholder="SULFURIC ACID"/>
                                    </div>
                                </div>
                            </div>

                            <div className="space-y-4">
                                <h3 className="font-bold text-red-600 text-lg border-b-2 pb-2">‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢</h3>
                                <div>
                                    <label className="text-xs font-bold text-gray-500 mb-1 flex justify-between">
                                        <span>‡∏£‡∏π‡∏õ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 9 ‡∏£‡∏π‡∏õ)</span>
                                        <button onClick={() => setShowGallery(true)} className="text-indigo-500 hover:underline text-xs">‡∏Ñ‡∏•‡∏±‡∏á‡∏£‡∏π‡∏õ</button>
                                    </label>
                                    <div className="flex gap-2 flex-wrap">
                                        <label className="flex-grow flex flex-col items-center justify-center p-3 border-2 border-dashed rounded-xl cursor-pointer hover:bg-gray-50 min-h-[60px]">
                                            <span className="text-2xl">‚¨ÜÔ∏è</span>
                                            <span className="mt-1 text-xs font-bold text-gray-400">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</span>
                                            <input type="file" accept="image/*" multiple className="hidden" onChange={handlePictogramUpload} />
                                        </label>
                                        {formData.pictograms.map((img, i) => (
                                            <div key={i} className="relative w-16 h-16 border rounded-lg bg-gray-50">
                                                <img src={img} className="w-full h-full object-contain p-1" alt="Pictogram" />
                                                <button onClick={() => removePictogram(i)} className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">√ó</button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="bg-gray-50 p-3 rounded-xl">
                                    <label className="text-xs font-bold text-gray-500 mb-2 block text-center">‡∏£‡∏´‡∏±‡∏™ NFPA</label>
                                    <div className="grid grid-cols-4 gap-2">
                                        <div>
                                            <span className="text-xs font-bold text-blue-600 block mb-1">H</span>
                                            <input className="border p-1 text-center w-full rounded font-bold" value={formData.nfpaHealth} onChange={e => setFormData({...formData, nfpaHealth: e.target.value})} />
                                        </div>
                                        <div>
                                            <span className="text-xs font-bold text-red-600 block mb-1">F</span>
                                            <input className="border p-1 text-center w-full rounded font-bold" value={formData.nfpaFlammability} onChange={e => setFormData({...formData, nfpaFlammability: e.target.value})} />
                                        </div>
                                        <div>
                                            <span className="text-xs font-bold text-yellow-600 block mb-1">I</span>
                                            <input className="border p-1 text-center w-full rounded font-bold" value={formData.nfpaInstability} onChange={e => setFormData({...formData, nfpaInstability: e.target.value})} />
                                        </div>
                                        <div>
                                            <span className="text-xs font-bold text-gray-600 block mb-1">S</span>
                                            <input className="border p-1 text-center w-full rounded font-bold" value={formData.nfpaSpecial} onChange={e => setFormData({...formData, nfpaSpecial: e.target.value})} />
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label className="text-xs font-bold text-gray-500 ml-1">‡∏Ñ‡∏≥‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì</label>
                                    <select className="w-full p-2.5 rounded-lg bg-gray-50 font-bold" value={formData.signalWord} onChange={e => setFormData({...formData, signalWord: e.target.value})}>
                                        <option value="DANGER">üî¥ DANGER</option>
                                        <option value="WARNING">üü† WARNING</option>
                                        <option value="">‚ö™ NONE</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="text-xs font-bold text-gray-500 ml-1">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢</label>
                                    <textarea className="w-full p-3 rounded-lg bg-gray-50 text-sm" rows="4" value={formData.hazardStatements} onChange={e => setFormData({...formData, hazardStatements: e.target.value})} />
                                </div>
                                <div>
                                    <label className="text-xs font-bold text-gray-500 ml-1">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á</label>
                                    <textarea className="w-full p-3 rounded-lg bg-gray-50 text-sm" rows="3" value={formData.precautionaryStatements} onChange={e => setFormData({...formData, precautionaryStatements: e.target.value})} />
                                </div>
                            </div>

                            <div className="space-y-4">
                                <h3 className="font-bold text-blue-600 text-lg border-b-2 pb-2">üõ°Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</h3>
                                <div className="bg-blue-50 p-4 rounded-xl">
                                    <label className="text-xs font-bold text-blue-700 mb-2 block">PPE Specific</label>
                                    <textarea className="w-full p-3 rounded-lg bg-white border text-sm" rows="3" value={formData.ppeText} onChange={e => setFormData({...formData, ppeText: e.target.value})} placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå PPE ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ..." />
                                </div>
                                <div className="bg-blue-50 p-4 rounded-xl">
                                    <label className="text-xs font-bold text-blue-700 mb-1 flex justify-between">
                                        <span>‡∏£‡∏π‡∏õ PPE (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡∏£‡∏π‡∏õ)</span>
                                        <button onClick={() => setShowPPEGallery(true)} className="text-indigo-500 hover:underline text-xs">‡∏Ñ‡∏•‡∏±‡∏á‡∏£‡∏π‡∏õ PPE</button>
                                    </label>
                                    <div className="grid grid-cols-5 gap-2">
                                        {[0, 1, 2, 3, 4].map(index => (
                                            <div key={index} className="relative">
                                                <div className="flex flex-col items-center justify-center p-2 border-2 border-dashed bg-white rounded-xl cursor-pointer hover:bg-blue-100 transition h-16" onClick={() => openPPEGalleryForSlot(index)}>
                                                    {formData.ppeImages[index] ? (
                                                        <img src={formData.ppeImages[index]} className="max-h-full max-w-full object-contain" alt={`PPE ${index+1}`} />
                                                    ) : (
                                                        <span className="text-xs text-gray-400">+</span>
                                                    )}
                                                </div>
                                                {formData.ppeImages[index] && (
                                                    <button onClick={() => clearPPEImage(index)} className="absolute -top-1.5 -right-1.5 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">√ó</button>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Preview */}
                        <div className="w-full lg:w-2/3 flex flex-col items-center pt-4">
                            <div className="no-print mb-4 text-sm font-bold text-white bg-white/20 px-4 py-2 rounded-full backdrop-blur">
                                üëÜ ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏õ‡πâ‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
                            </div>
                            <div className="w-full">
                                <GHSLabel id="tank-label-preview" formData={formData} scales={scales} onClick={() => setIsModalOpen(true)} />
                            </div>
                        </div>
                    </div>

                    {/* Pictogram Gallery Modal */}
                    {showGallery && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col">
                                <div className="p-4 border-b bg-indigo-50 flex justify-between items-center">
                                    <h3 className="font-bold text-indigo-700 text-lg">‡∏Ñ‡∏•‡∏±‡∏á‡∏£‡∏π‡∏õ Pictogram</h3>
                                    <button onClick={() => setShowGallery(false)} className="text-gray-400 hover:text-red-500 text-2xl">√ó</button>
                                </div>
                                <div className="p-4 bg-indigo-50 border-b">
                                    <label className="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-full cursor-pointer inline-flex items-center gap-2">
                                        <span>‚¨ÜÔ∏è ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà</span>
                                        <input type="file" accept="image/*" className="hidden" onChange={addToLibrary} />
                                    </label>
                                </div>
                                <div className="flex-grow overflow-y-auto p-4 bg-gray-50">
                                    <div className="gallery-grid">
                                        {libraryImages.length > 0 ? libraryImages.map((img, i) => (
                                            <div key={i} className="gallery-item" onClick={() => selectFromLibrary(img)}>
                                                <img src={img} className="w-full h-full object-contain" alt="Lib" />
                                                <div className="gallery-delete" onClick={(e) => deleteFromLibrary(i, e)}>√ó</div>
                                            </div>
                                        )) : (
                                            <div className="col-span-full text-center text-gray-400 py-10">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á</div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* PPE Gallery Modal */}
                    {showPPEGallery && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col">
                                <div className="p-4 border-b bg-blue-50 flex justify-between items-center">
                                    <h3 className="font-bold text-blue-700 text-lg">‡∏Ñ‡∏•‡∏±‡∏á‡∏£‡∏π‡∏õ PPE</h3>
                                    <button onClick={() => setShowPPEGallery(false)} className="text-gray-400 hover:text-red-500 text-2xl">√ó</button>
                                </div>
                                <div className="p-4 bg-blue-50 border-b">
                                    <label className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full cursor-pointer inline-flex items-center gap-2">
                                        <span>‚¨ÜÔ∏è ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ PPE ‡πÉ‡∏´‡∏°‡πà</span>
                                        <input type="file" accept="image/*" className="hidden" onChange={addToPPELibrary} />
                                    </label>
                                </div>
                                <div className="flex-grow overflow-y-auto p-4 bg-gray-50">
                                    <div className="gallery-grid">
                                        {ppeLibraryImages.length > 0 ? ppeLibraryImages.map((img, i) => (
                                            <div key={i} className="gallery-item" onClick={() => selectFromPPELibrary(img)}>
                                                <img src={img} className="w-full h-full object-contain" alt="PPE Lib" />
                                                <div className="gallery-delete" onClick={(e) => deleteFromPPELibrary(i, e)}>√ó</div>
                                            </div>
                                        )) : (
                                            <div className="col-span-full text-center text-gray-400 py-10">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á</div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Template Library Modal (Updated with Export/Import) */}
                    {showLibrary && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[80vh] flex flex-col">
                                <div className="p-4 border-b bg-yellow-50 flex justify-between items-center">
                                    <h3 className="font-bold text-yellow-700 text-lg">üìÇ ‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</h3>
                                    <button onClick={() => setShowLibrary(false)} className="text-gray-400 hover:text-red-500 text-2xl">√ó</button>
                                </div>
                                {/* Export/Import Controls */}
                                <div className="p-3 bg-gray-50 border-b flex gap-2 justify-center">
                                    <button onClick={handleExportData} className="text-xs bg-blue-600 text-white px-3 py-1.5 rounded hover:bg-blue-700">‚¨áÔ∏è ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                                    <label className="text-xs bg-green-600 text-white px-3 py-1.5 rounded hover:bg-green-700 cursor-pointer">
                                        ‚¨ÜÔ∏è ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                                        <input type="file" accept=".json" className="hidden" onChange={handleImportData} />
                                    </label>
                                </div>
                                <div className="flex-grow overflow-y-auto p-4">
                                    {savedLabels.length > 0 ? (
                                        <div className="space-y-2">
                                            {savedLabels.map((item) => (
                                                <div key={item.id} className="flex justify-between items-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onClick={() => handleLoadTemplate(item)}>
                                                    <div>
                                                        <div className="font-bold text-gray-800">{item.name}</div>
                                                        <div className="text-xs text-gray-400">{item.data.tankId} ‚Ä¢ {item.data.productName}</div>
                                                    </div>
                                                    <button onClick={(e) => handleDeleteTemplate(item.id, e)} className="text-red-500 hover:bg-red-50 p-2 rounded-full">üóëÔ∏è</button>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="text-center text-gray-400 py-10">
                                            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö<br/>
                                            <span className="text-xs text-gray-300">‡∏Å‡∏î "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà</span>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Full Preview Modal for Download (Fixed Scroll) */}
                    {isModalOpen && (
                        <div className="fixed inset-0 z-50 overflow-y-auto bg-black/80 backdrop-blur-md">
                            <div className="flex min-h-screen items-center justify-center p-4">
                                <div className="relative bg-white p-2 rounded shadow-2xl max-w-5xl w-full my-8">
                                    <button onClick={() => setIsModalOpen(false)} className="absolute -top-10 right-0 text-white text-3xl hover:text-gray-300 z-50">√ó</button>
                                    
                                    <div id="tank-label-modal-content" className="w-full bg-white">
                                        <GHSLabel formData={formData} scales={scales} />
                                    </div>
                                    
                                    <div className="mt-6 flex justify-center gap-4 no-print pb-2">
                                        <button 
                                            onClick={handleDownloadPDF} 
                                            disabled={isGenerating}
                                            className="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg flex items-center gap-2 disabled:bg-gray-400 transition-all transform hover:scale-105"
                                        >
                                            {isGenerating ? '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...' : 'üìÑ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF (A4)'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>