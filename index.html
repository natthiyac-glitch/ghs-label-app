<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GHS Label Generator üçä</title>
    
    <!-- 1. Load Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Libraries for Image Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Google Fonts: Fredoka (Rounded) & Sarabun (Thai) -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600&family=Sarabun:wght@300;400;600&display=swap');
        
        body { 
            font-family: 'Sarabun', sans-serif; 
            /* Theme: Orange & Sky Blue */
            background-color: #fff7ed; /* Orange-50 */
            background-image: radial-gradient(#fed7aa 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        h1, h2, h3, .kawaii-font { font-family: 'Fredoka', sans-serif; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #fdba74; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #fb923c; }

        /* Cute Inputs */
        input, select, textarea {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
        }
        input:focus, select:focus, textarea:focus {
            border-color: #7dd3fc;
            box-shadow: 0 0 0 3px rgba(125, 211, 252, 0.3);
            outline: none;
        }

        /* Print Styles */
        @media print {
            @page { size: landscape; margin: 0; }
            body { background: white; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .no-print { display: none !important; }
            #tank-label-preview { 
                position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; 
                border: none; margin: 0; max-width: none; 
                box-shadow: none !important;
                transform: none !important;
                z-index: 9999;
            }
        }
        
        /* Custom Slider Style */
        input[type=range] {
            height: 25px;
            -webkit-appearance: none;
            margin: 5px 0;
            width: 100%;
            background: transparent;
        }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            animate: 0.2s;
            background: #e5e7eb;
            border-radius: 10px;
        }
        input[type=range]::-webkit-slider-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #38bdf8; /* Sky-400 */
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            -webkit-appearance: none;
            margin-top: -6px;
        }
    </style>
</head>
<body class="text-gray-700">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS ---
        const Icons = {
            Printer: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9V2h12v7"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><path d="M6 14h12v8H6z"/></svg>,
            Settings: <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
            Upload: <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
            Type: <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" y1="20" x2="15" y2="20"/><line x1="12" y1="4" x2="12" y2="20"/></svg>,
            Download: <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
            Close: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            Trash: <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>,
            Heart: <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#FCA5A5" stroke="#EF4444" strokeWidth="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>,
            ImageIcon: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>,
            Maximize: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M15 3h6v6"/><path d="M9 21H3v-6"/><path d="M21 3l-7 7"/><path d="M3 21l7-7"/></svg>
        };

        const EXTINGUISHING_MEDIA = ["Water Spray (‡∏ô‡πâ‡∏≥)", "Foam (‡πÇ‡∏ü‡∏°)", "Carbon Dioxide (CO2)", "Dry Chemical (‡∏ú‡∏á‡πÄ‡∏Ñ‡∏°‡∏µ‡πÅ‡∏´‡πâ‡∏á)", "Do NOT use water (‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏ô‡πâ‡∏≥)"];
        
        const PPE_LIST = [
            "Safety Helmet (‡∏´‡∏°‡∏ß‡∏Å‡∏ô‡∏¥‡∏£‡∏†‡∏±‡∏¢)",           
            "Safety Glasses / Goggles (‡πÅ‡∏ß‡πà‡∏ô‡∏ï‡∏≤‡∏ô‡∏¥‡∏£‡∏†‡∏±‡∏¢)",
            "Chemical Mask (‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å‡∏Å‡∏±‡∏ô‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ)",    
            "Full Face Mask (‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å‡πÄ‡∏ï‡πá‡∏°‡∏´‡∏ô‡πâ‡∏≤)",
            "Chemical Resistant Gloves (‡∏ñ‡∏∏‡∏á‡∏°‡∏∑‡∏≠‡∏¢‡∏≤‡∏á)",
            "Protective Suit (‡∏ä‡∏∏‡∏î‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ)",
            "Safety Boots (‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏ô‡∏¥‡∏£‡∏†‡∏±‡∏¢)"
        ];

        // --- COMPONENTS ---
        const NFPADiamond = ({ health, flammability, instability, special }) => (
            <div className="relative w-full h-full transform hover:scale-105 transition-transform duration-300">
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-md">
                    <polygon points="50,50 25,75 0,50 25,25" fill="#60A5FA" stroke="black" strokeWidth="1" />
                    <polygon points="50,50 25,25 50,0 75,25" fill="#F87171" stroke="black" strokeWidth="1" />
                    <polygon points="50,50 75,25 100,50 75,75" fill="#FBBF24" stroke="black" strokeWidth="1" />
                    <polygon points="50,50 75,75 50,100 25,75" fill="white" stroke="black" strokeWidth="1" />
                    <text x="25" y="55" textAnchor="middle" fontSize="22" fontWeight="bold" fill="black" className="font-sans">{health}</text>
                    <text x="50" y="30" textAnchor="middle" fontSize="22" fontWeight="bold" fill="black" className="font-sans">{flammability}</text>
                    <text x="75" y="55" textAnchor="middle" fontSize="22" fontWeight="bold" fill="black" className="font-sans">{instability}</text>
                    <text x="50" y="80" textAnchor="middle" fontSize="16" fontWeight="bold" fill="black" className="font-sans">{special}</text>
                </svg>
            </div>
        );

        const FontSlider = ({ label, value, onChange }) => (
            <div className="flex flex-col mb-2 p-2 bg-white rounded-lg border border-orange-100 shadow-sm">
                <div className="flex justify-between items-center mb-1">
                    <label className="text-xs font-bold text-orange-500 kawaii-font tracking-wide">{label}</label>
                    <span className="text-[10px] text-sky-500 font-bold bg-sky-50 px-2 py-0.5 rounded-full">{Math.round(value * 100)}%</span>
                </div>
                <input 
                    type="range" 
                    min="0.5" 
                    max="2.0" 
                    step="0.05" 
                    value={value} 
                    onChange={(e) => onChange(parseFloat(e.target.value))} 
                />
            </div>
        );

        // --- SHARED LABEL RENDERER ---
        const GHSLabel = ({ formData, scales, id, onClick }) => (
            <div id={id} onClick={onClick} className={`bg-white border-4 border-black w-full aspect-[1.5/1] flex flex-col shadow-2xl relative overflow-hidden leading-tight mx-auto transition-all duration-300 ${onClick ? 'cursor-pointer' : ''}`}>
                {/* Header */}
                <div className="flex border-b-4 border-black h-[18%] box-border">
                    <div className="w-[20%] bg-yellow-300 flex items-center justify-center border-r-4 border-black p-1">
                        <span className="font-black font-mono tracking-tighter leading-none" style={{ fontSize: `${2.5 * scales.tankId}rem` }}>{formData.tankId}</span>
                    </div>
                    <div className="w-[60%] flex items-center justify-center p-2 text-center border-r-4 border-black">
                        <span className="font-black uppercase leading-none" style={{ fontSize: `${2.2 * scales.productName}rem` }}>{formData.productName || "CHEMICAL NAME"}</span>
                    </div>
                    <div className="w-[20%] flex flex-col items-center justify-center p-1 bg-gray-100">
                        <span className="font-bold text-gray-500 uppercase leading-none mb-1" style={{ fontSize: `${0.7 * scales.unNumber}rem` }}>UN Number</span>
                        <span className="font-black font-mono leading-none" style={{ fontSize: `${2 * scales.unNumber}rem` }}>{formData.unNumber || "----"}</span>
                    </div>
                </div>

                {/* Body */}
                <div className="flex flex-grow border-b-4 border-black box-border h-[62%]">
                    <div className="w-[30%] border-r-4 border-black flex flex-col">
                        <div className="h-[60%] flex flex-col items-center justify-center p-2 gap-2">
                            <div className="w-24 h-24 lg:w-32 lg:h-32">
                                <NFPADiamond 
                                    health={formData.nfpaHealth} 
                                    flammability={formData.nfpaFlammability} 
                                    instability={formData.nfpaInstability} 
                                    special={formData.nfpaSpecial} 
                                />
                            </div>
                            {formData.signalWord && (
                                <div className={`font-black uppercase tracking-widest px-4 py-2 rounded flex items-center justify-center ${formData.signalWord === 'DANGER' ? 'bg-red-600 text-white' : 'bg-orange-500 text-white'}`} style={{ fontSize: `1.5rem` }}>
                                    <span className="leading-none">{formData.signalWord}</span>
                                </div>
                            )}
                        </div>
                        <div className="h-[40%] border-t-4 border-black bg-white flex items-center justify-center p-1 overflow-hidden relative">
                            {formData.pictogramImage ? 
                                <img src={formData.pictogramImage} className="max-h-full max-w-full object-contain" /> : 
                                <div className="w-full h-full bg-white"></div>
                            }
                        </div>
                    </div>
                    <div className="w-[70%] p-4 flex flex-col justify-start overflow-hidden">
                        <h3 className="font-bold underline mb-2 leading-none" style={{ fontSize: `${1.2 * scales.hazard}rem` }}>HAZARD STATEMENTS:</h3>
                        <p className="whitespace-pre-line font-semibold leading-relaxed" style={{ fontSize: `${1 * scales.hazard}rem` }}>{formData.hazardStatements || "..."}</p>
                    </div>
                </div>

                {/* Footer */}
                <div className="h-[20%] flex box-border">
                    <div className="w-[40%] border-r-4 border-black p-2 flex flex-col bg-white">
                        <div className="flex items-center justify-center mb-1">
                            <span className="font-bold uppercase bg-black text-white px-3 py-1 rounded flex items-center justify-center leading-none" style={{ fontSize: `${0.8 * scales.ext}rem` }}>
                                Extinguishing Media
                            </span>
                        </div>
                        <div className="flex-grow overflow-hidden pl-2 pt-1">
                            <ul className="list-disc list-inside font-bold leading-tight space-y-0.5" style={{ fontSize: `${0.9 * scales.ext}rem` }}>
                                {formData.selectedExtMedia.map(item => <li key={item}>{item}</li>)}
                            </ul>
                        </div>
                    </div>
                    <div className="w-[60%] p-2 flex bg-blue-50">
                        <div className="w-1/2 pr-2 flex flex-col border-r border-blue-200">
                            <div className="flex items-center justify-start mb-1">
                                <span className="font-bold uppercase bg-blue-800 text-white px-3 py-1 rounded flex items-center justify-center leading-none" style={{ fontSize: `${0.8 * scales.ppe}rem` }}>
                                    PPE Required
                                </span>
                            </div>
                            <div className="flex-grow overflow-hidden pl-1">
                                <ul className="space-y-0.5" style={{ fontSize: `${0.75 * scales.ppe}rem` }}>
                                    {formData.selectedPPEList.map(item => <li key={item} className="flex items-start gap-1"><span className="font-semibold text-blue-900 leading-tight">‚Ä¢ {item}</span></li>)}
                                </ul>
                            </div>
                        </div>
                        <div className="w-1/2 pl-2 flex items-center justify-center relative">
                            {formData.ppeImage ? 
                                <img src={formData.ppeImage} className="max-h-full max-w-full object-contain" /> : 
                                <div className="w-full h-full bg-white"></div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        );

        // --- MAIN APP ---
        function App() {
            const [formData, setFormData] = useState({
                tankId: 'T-0101',
                productName: '',
                unNumber: '',
                signalWord: 'DANGER',
                hazardStatements: '',
                selectedExtMedia: [],
                selectedPPEList: [],
                pictogramImage: null,
                ppeImage: null,
                nfpaHealth: 0, nfpaFlammability: 0, nfpaInstability: 0, nfpaSpecial: '',
            });

            const [scales, setScales] = useState({
                tankId: 1, productName: 1, unNumber: 1, hazard: 1, ext: 1, ppe: 1
            });

            const [showFontPanel, setShowFontPanel] = useState(false);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [isGenerating, setIsGenerating] = useState(false);

            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                if (params.has('tankId')) setFormData(prev => ({ ...prev, tankId: params.get('tankId') }));
                if (params.has('product')) setFormData(prev => ({ ...prev, productName: params.get('product') }));
                if (params.has('un')) setFormData(prev => ({ ...prev, unNumber: params.get('un') }));
                if (params.has('signal')) setFormData(prev => ({ ...prev, signalWord: params.get('signal') }));
                if (params.has('hzd')) setFormData(prev => ({ ...prev, hazardStatements: decodeURIComponent(params.get('hzd')) }));
            }, []);

            const handleImageUpload = (e, field) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => setFormData(prev => ({ ...prev, [field]: reader.result }));
                    reader.readAsDataURL(file);
                }
            };

            const clearImage = (field) => {
                setFormData(prev => ({ ...prev, [field]: null }));
            };

            const toggleSelection = (field, item) => {
                setFormData(prev => {
                    const list = prev[field];
                    return list.includes(item) ? { ...prev, [field]: list.filter(i => i !== item) } : { ...prev, [field]: [...list, item] };
                });
            };

            const updateScale = (key, value) => {
                setScales(prev => ({ ...prev, [key]: value }));
            };

            const handleDownloadImage = async () => {
                setIsGenerating(true);
                // Wait for render
                await new Promise(resolve => setTimeout(resolve, 300)); 
                
                try {
                    // Strategy: Clone the PREVIEW label (which looks correct) to a fixed container
                    // This ignores screen size/modal scaling issues.
                    const originalElement = document.getElementById('tank-label-preview'); // Use the ID from the main preview
                    
                    if (!originalElement) throw new Error("Label element not found");

                    const clone = originalElement.cloneNode(true);
                    
                    // Reset any potential transforms on the clone
                    clone.style.transform = 'none';
                    clone.style.margin = '0';
                    clone.style.boxShadow = 'none';
                    
                    // Create a fixed-size container (Large enough for good quality)
                    const width = 1200;
                    const height = 800; // Aspect ratio 1.5:1
                    
                    const container = document.createElement('div');
                    container.style.position = 'fixed';
                    container.style.top = '-10000px';
                    container.style.left = '-10000px';
                    container.style.width = `${width}px`;
                    container.style.height = `${height}px`;
                    container.style.zIndex = '-1';
                    container.style.overflow = 'hidden';
                    
                    // Force the clone to fill this container
                    clone.style.width = '100%';
                    clone.style.height = '100%';
                    
                    container.appendChild(clone);
                    document.body.appendChild(container);
                    
                    // Capture
                    const canvas = await html2canvas(clone, { 
                        scale: 2, // High res
                        useCORS: true, 
                        logging: false, 
                        width: width,
                        height: height,
                        backgroundColor: '#ffffff',
                        windowWidth: width,
                        windowHeight: height,
                        scrollX: 0,
                        scrollY: 0,
                        x: 0,
                        y: 0
                    });
                    
                    document.body.removeChild(container);

                    const link = document.createElement('a');
                    link.download = `GHS-Label-${formData.tankId || 'Export'}.png`;
                    link.href = canvas.toDataURL('image/png', 1.0);
                    link.click();

                } catch (error) {
                    console.error("Image Error:", error);
                    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û");
                } finally {
                    setIsGenerating(false);
                }
            };

            return (
                <div className="min-h-screen relative pb-10">
                    
                    {/* Header Bar (Orange Theme) */}
                    <div className="no-print bg-white/80 backdrop-blur-md shadow-sm border-b border-orange-100 sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto p-3 flex flex-col md:flex-row justify-between items-center gap-3">
                            <h1 className="text-2xl font-bold text-orange-500 flex items-center gap-2 kawaii-font">
                                <span className="bg-orange-100 p-2 rounded-full">{Icons.Settings}</span>
                                GHS Label Maker
                            </h1>
                            
                            <div className="flex flex-wrap items-center gap-2 justify-center relative">
                                {/* Font Toggle Button */}
                                <button 
                                    onClick={() => setShowFontPanel(!showFontPanel)}
                                    className={`flex items-center gap-2 px-4 py-2 rounded-full border-2 transition-all font-bold text-sm kawaii-font
                                    ${showFontPanel ? 'bg-sky-100 border-sky-400 text-sky-700' : 'bg-white border-gray-200 text-gray-600 hover:border-sky-300 hover:bg-sky-50'}`}
                                >
                                    {Icons.Type} Adjust Font
                                </button>

                                {/* Font Panel Popup */}
                                {showFontPanel && (
                                    <div className="absolute top-14 left-0 md:right-0 md:left-auto bg-white p-5 shadow-2xl border-2 border-orange-100 rounded-3xl z-50 w-80 grid grid-cols-1 gap-1 animate-fade-in-down">
                                        <div className="flex justify-between items-center border-b border-dashed pb-2 mb-2">
                                            <h3 className="font-bold text-orange-500 text-sm kawaii-font">Size Adjustment</h3>
                                            <button onClick={() => setShowFontPanel(false)} className="text-gray-400 hover:text-red-500 bg-gray-100 hover:bg-red-50 p-1 rounded-full transition">{Icons.Close}</button>
                                        </div>
                                        <div className="max-h-[300px] overflow-y-auto pr-2 custom-scrollbar">
                                            <FontSlider label="Tank ID" value={scales.tankId} onChange={v => updateScale('tankId', v)} />
                                            <FontSlider label="Chemical Name" value={scales.productName} onChange={v => updateScale('productName', v)} />
                                            <FontSlider label="UN Number" value={scales.unNumber} onChange={v => updateScale('unNumber', v)} />
                                            <FontSlider label="Hazard Statements" value={scales.hazard} onChange={v => updateScale('hazard', v)} />
                                            <FontSlider label="Extinguishing Media" value={scales.ext} onChange={v => updateScale('ext', v)} />
                                            <FontSlider label="PPE Required" value={scales.ppe} onChange={v => updateScale('ppe', v)} />
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto p-4 md:p-8 flex flex-col lg:flex-row gap-8">
                        
                        {/* LEFT: INPUT FORM (Orange Theme) */}
                        <div className="no-print w-full lg:w-1/3 bg-white p-6 rounded-3xl shadow-xl shadow-orange-100/50 border border-orange-50 space-y-6 h-fit overflow-y-auto max-h-[85vh]">
                            
                            {/* Section 1 */}
                            <div className="space-y-4">
                                <h3 className="font-bold text-orange-500 flex items-center gap-2 text-lg kawaii-font border-b-2 border-orange-100 pb-2">
                                    <span className="bg-orange-100 text-orange-600 rounded-lg p-1 text-sm">01</span> General Info
                                </h3>
                                <div className="grid grid-cols-2 gap-3">
                                    <div>
                                        <label className="text-xs font-bold text-gray-400 ml-1">Tank ID</label>
                                        <input type="text" className="w-full p-2.5 rounded-xl bg-orange-50" value={formData.tankId} onChange={e => setFormData({...formData, tankId: e.target.value})} placeholder="T-0101" />
                                    </div>
                                    <div>
                                        <label className="text-xs font-bold text-gray-400 ml-1">UN Number</label>
                                        <input type="text" className="w-full p-2.5 rounded-xl bg-orange-50" value={formData.unNumber} onChange={e => setFormData({...formData, unNumber: e.target.value})} placeholder="1830" />
                                    </div>
                                    <div className="col-span-2">
                                        <label className="text-xs font-bold text-gray-400 ml-1">Product Name</label>
                                        <input type="text" className="w-full p-2.5 rounded-xl bg-orange-50 font-bold text-gray-700" value={formData.productName} onChange={e => setFormData({...formData, productName: e.target.value})} placeholder="SULFURIC ACID" />
                                    </div>
                                </div>
                            </div>

                            {/* Section 2 */}
                             <div className="space-y-4">
                                <h3 className="font-bold text-sky-500 flex items-center gap-2 text-lg kawaii-font border-b-2 border-sky-100 pb-2">
                                    <span className="bg-sky-100 text-sky-600 rounded-lg p-1 text-sm">02</span> Hazards
                                </h3>
                                
                                {/* Image Upload with Clear Button */}
                                <div>
                                    <label className="text-xs font-bold text-gray-400 ml-1 mb-1 block">Pictogram</label>
                                    <div className="flex gap-2">
                                        <label className="flex-grow flex flex-col items-center justify-center p-4 border-2 border-dashed border-sky-200 rounded-2xl cursor-pointer hover:bg-sky-50 transition-colors group">
                                            <div className="text-sky-300 group-hover:text-sky-500 transition-colors transform group-hover:scale-110 duration-300">{Icons.Upload}</div>
                                            <span className="mt-1 text-xs font-bold text-sky-400">{formData.pictogramImage ? "Change Image" : "Upload Image"}</span>
                                            <input type="file" accept="image/*" className="hidden" onChange={(e) => handleImageUpload(e, 'pictogramImage')} />
                                        </label>
                                        {formData.pictogramImage && (
                                            <button onClick={() => clearImage('pictogramImage')} className="flex items-center justify-center w-12 bg-red-50 border-2 border-red-100 rounded-2xl hover:bg-red-100 text-red-400 transition-colors" title="Remove Image">
                                                {Icons.Trash}
                                            </button>
                                        )}
                                    </div>
                                </div>
                                
                                {/* NFPA Inputs */}
                                <div className="bg-sky-50 p-3 rounded-xl">
                                    <label className="text-xs font-bold text-gray-400 mb-2 block text-center">NFPA Codes</label>
                                    <div className="grid grid-cols-4 gap-2">
                                        {['nfpaHealth', 'nfpaFlammability', 'nfpaInstability', 'nfpaSpecial'].map((f, i) => (
                                            <div key={f} className="text-center">
                                                <span className={`text-[10px] font-bold block mb-1 ${['text-blue-500','text-red-500','text-yellow-500','text-gray-500'][i]}`}>{['H','F','I','S'][i]}</span>
                                                <input className="border-2 p-1 text-center w-full rounded-lg font-bold" value={formData[f]} onChange={e => setFormData({...formData, [f]: e.target.value})} />
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <select className="w-full p-2.5 rounded-xl bg-sky-50 font-bold text-gray-600" value={formData.signalWord} onChange={e => setFormData({...formData, signalWord: e.target.value})}>
                                    <option value="DANGER">üî¥ DANGER</option> <option value="WARNING">üü† WARNING</option> <option value="">‚ö™ NONE</option>
                                </select>
                                <textarea className="w-full p-3 rounded-xl bg-sky-50 text-sm" rows="4" value={formData.hazardStatements} onChange={e => setFormData({...formData, hazardStatements: e.target.value})} placeholder="Hazard Statements..."></textarea>
                            </div>

                            {/* Section 3 */}
                            <div className="space-y-4">
                                <h3 className="font-bold text-amber-500 flex items-center gap-2 text-lg kawaii-font border-b-2 border-amber-100 pb-2">
                                    <span className="bg-amber-100 text-amber-600 rounded-lg p-1 text-sm">03</span> Safety
                                </h3>
                                
                                <div className="bg-amber-50 p-4 rounded-2xl">
                                    <label className="text-xs font-bold text-amber-400 mb-2 block">Extinguishing Media</label>
                                    <div className="space-y-1">
                                        {EXTINGUISHING_MEDIA.map(item => (
                                            <label key={item} className="flex items-center gap-2 text-sm cursor-pointer hover:text-amber-700 transition">
                                                <input type="checkbox" checked={formData.selectedExtMedia.includes(item)} onChange={() => toggleSelection('selectedExtMedia', item)} className="accent-amber-500 w-4 h-4 rounded" /> 
                                                <span className="text-gray-600">{item}</span>
                                            </label>
                                        ))}
                                    </div>
                                </div>

                                <div className="bg-orange-50 p-4 rounded-2xl">
                                    <label className="text-xs font-bold text-orange-400 mb-2 block">PPE Required</label>
                                    <div className="space-y-1 mb-3">
                                        {PPE_LIST.map(item => (
                                            <label key={item} className="flex items-center gap-2 text-sm cursor-pointer hover:text-orange-700 transition">
                                                <input type="checkbox" checked={formData.selectedPPEList.includes(item)} onChange={() => toggleSelection('selectedPPEList', item)} className="accent-orange-500 w-4 h-4 rounded" /> 
                                                <span className="text-gray-600">{item}</span>
                                            </label>
                                        ))}
                                    </div>
                                    
                                    {/* PPE Upload with Remove Button */}
                                    <div className="flex gap-2">
                                        <label className="flex-grow flex flex-col items-center justify-center p-3 border-2 border-dashed border-orange-200 bg-white rounded-xl cursor-pointer hover:bg-orange-100 transition-colors">
                                            <div className="text-orange-300 mb-1">{Icons.Upload}</div>
                                            <span className="text-xs font-bold text-orange-400">{formData.ppeImage ? "Change PPE Image" : "Upload PPE Image"}</span>
                                            <input type="file" accept="image/*" className="hidden" onChange={(e) => handleImageUpload(e, 'ppeImage')} />
                                        </label>
                                        {formData.ppeImage && (
                                            <button onClick={() => clearImage('ppeImage')} className="flex items-center justify-center w-12 bg-red-50 border-2 border-red-100 rounded-2xl hover:bg-red-100 text-red-400 transition-colors" title="Remove Image">
                                                {Icons.Trash}
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* RIGHT: PREVIEW AREA */}
                        <div className="w-full lg:w-2/3 flex flex-col items-center pt-4">
                            <div className="no-print mb-4 flex items-center gap-2 text-gray-400 text-sm font-bold bg-white px-4 py-1 rounded-full shadow-sm animate-bounce">
                                Click Label to Expand & Download
                            </div>
                            
                            <div className="preview-container relative w-full flex justify-center group">
                                <GHSLabel 
                                    id="tank-label-preview"
                                    formData={formData} 
                                    scales={scales} 
                                    onClick={() => setIsModalOpen(true)}
                                />
                                <div className="overlay absolute inset-0 bg-black/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none rounded-lg">
                                    <div className="bg-white text-gray-800 px-4 py-2 rounded-full font-bold shadow-lg flex items-center gap-2 transform scale-0 group-hover:scale-100 transition-transform duration-300">
                                        {Icons.Maximize} Click to Expand
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* MODAL FOR EXPANDED VIEW & DOWNLOAD */}
                    {isModalOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in">
                            <div className="bg-white rounded-3xl shadow-2xl w-full max-w-6xl max-h-[95vh] flex flex-col overflow-hidden relative">
                                
                                {/* Modal Header */}
                                <div className="p-4 border-b flex justify-between items-center bg-gray-50">
                                    <h2 className="text-xl font-bold text-gray-700 flex items-center gap-2 kawaii-font">
                                        {Icons.ImageIcon} Label Preview
                                    </h2>
                                    <div className="flex gap-2">
                                        <button onClick={handleDownloadImage} disabled={isGenerating} className="flex items-center gap-2 bg-gradient-to-r from-orange-400 to-red-500 text-white px-6 py-2 rounded-full font-bold hover:shadow-lg hover:scale-105 transition-all text-sm kawaii-font disabled:opacity-50">
                                            {Icons.Download} {isGenerating ? 'Saving...' : 'Download Image'}
                                        </button>
                                        <button onClick={() => setIsModalOpen(false)} className="bg-gray-200 hover:bg-gray-300 text-gray-600 p-2 rounded-full transition">
                                            {Icons.Close}
                                        </button>
                                    </div>
                                </div>

                                {/* Modal Content (Scrollable) */}
                                <div className="p-8 overflow-y-auto flex items-center justify-center bg-gray-100 flex-grow">
                                    <div className="shadow-2xl">
                                        <GHSLabel 
                                            id="tank-label-modal-content"
                                            formData={formData} 
                                            scales={scales} 
                                            // No click handler in modal
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>